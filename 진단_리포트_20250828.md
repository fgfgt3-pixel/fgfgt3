# 🔍 키움 OpenAPI+ 호가/수급 데이터 0 문제 진단 리포트

## 📋 현재 상황 요약 (2025-08-28 10:09)
여전히 호가/수급 데이터가 취합되지 않고 있음.

### ✅ **해결된 문제들**
1. **키움 API 연결**: 정상 (로그인 성공, 실시간 체결 데이터 수신)
2. **호가 이벤트 수신**: 성공 (`[호가경고]` 로그 출현으로 확인)
3. **FID 분리 등록**: 체결과 호가 SetRealReg 분리 완료
4. **수급 필드명**: OPT10059 실제 스펙으로 정정

### ❌ **여전한 문제들**
1. **호가 데이터**: 이벤트는 수신되지만 모든 값이 0
2. **수급 데이터**: 11개 컬럼 모두 0.0 지속

## 🔧 **적용된 전문가 수정사항**

### 1. 호가 FID 분리 등록
```python
# 체결 FID (10~20) - 화면 015000
# 호가 FID (41~75) - 화면 015000H (별도)
basic_fid = OptimizedFID.BASIC_FID  # 체결 데이터만
hoga_fid = OptimizedFID.USE_ORDER_BOOK_FID  # 호가 데이터만
```

### 2. 수급 데이터 필드명 정정
```python
fields = {
    'indiv_net': '개인투자자',      # '개인' → '개인투자자'
    'foreign_net': '외국인투자자',   # '외국인' → '외국인투자자'
    'inst_net': '기관계',          # '기관' → '기관계'
    'pension_net': '연기금등',      # '연기금' → '연기금등'
    'prog_net': '내외국인'         # '프로그램' → '내외국인'
}
```

### 3. 키 매핑 수정
```python
# 수정 전: ask1_price, bid1_price
# 수정 후: ask1, bid1 (config.py와 일치)
ask1_price = data.get('ask1', 0)
bid1_price = data.get('bid1', 0)
```

## 📊 **진단 로그 강화**
- `📡 [실시간수신]`: 모든 real_type 추적
- `🔍 [FID검증]`: raw → parsed 변환 과정
- `💡 [데이터발견]`: 실제 값 있는 FID 식별
- `[수급파싱]`: OPT10059 필드별 raw 값

## 🔍 **추가 검토 필요 사항**

### 1. 호가 데이터 문제
**현상**: 호가 이벤트 수신되지만 FID 41~75 모두 0
**가능 원인**:
- FID 매핑이 키움 실제 스펙과 다름
- 호가 변경이 없는 시간대 테스트
- GetCommRealData 호출 방식 문제

### 2. 수급 데이터 문제  
**현상**: OPT10059 요청 성공하지만 모든 필드 빈 값
**가능 원인**:
- 필드명이 여전히 틀림
- TR 응답 구조가 예상과 다름
- 시장 시간 외 또는 데이터 없음

## 📝 **GitHub 업데이트 완료**
- **리포지토리**: https://github.com/fgfgt3-pixel/fgfgt3.git
- **최신 커밋**: 3dc4737 - "🔧 전문가 분석 반영 - 호가/수급 데이터 0 문제 해결 시도"

## 🔍 **전문가 추가 검토 요청 포인트**

1. **FID 스펙 검증**: 키움 API 실제 FID 41~75 스펙 확인
2. **OPT10059 구조**: 실제 TR 응답 필드명 확인  
3. **시장 시간**: 호가/수급 데이터가 실제로 변동하는 시간인가?
4. **API 호출 방식**: GetCommRealData vs GetCommData 차이점

**다음 단계**: KOA Studio 직접 테스트 또는 키움 개발 문서 재확인 필요